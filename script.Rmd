---
title: "Botany 575 Final Project: Suicide Rates, 1987-2016"
author: "Aryan Adhlakha, Kashin Shah, Sai Bulusu"
date: "4/22/2020"
output: html_document
---

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
```

## R Markdown

```{r read-transform-data, include = TRUE}
data = read_csv("master 2.csv")
```
1. Does age affect the suicide rate?
```{r}
ageAndSuicideRate = data %>% 
  select (country, year, age, `suicides/100k pop`) %>%
  group_by(age, year) %>%
  summarize(TotalSuicideRate=sum(`suicides/100k pop`))

ggplot(data = ageAndSuicideRate, aes(x = `year`, y = TotalSuicideRate, color=age)) + geom_point() + facet_wrap(~age) + geom_smooth(method = "lm", color='black') + ylab("Suicides per 100 thousand people") + xlab("Through the years") + ggtitle("Suicide numbers vs Years, for different age groups")

totalDeathsPerAge = ageAndSuicideRate %>%
  select(age, TotalSuicideRate) %>%
  group_by(age) %>%  
  summarize(TotalDeaths=sum(TotalSuicideRate)) %>%
  mutate(Percentage=paste(as.character(round(TotalDeaths/sum(TotalDeaths)*100)) ,"%"))

ggplot(totalDeathsPerAge, aes(x=age, y=Percentage)) +
  geom_bar(stat="identity", width=1, color="white", fill = "light blue") +
  ggtitle("Proportion of deaths/age group since 1987 to 2016") + geom_text(aes(label=Percentage), position=position_dodge(width=0.9), vjust=-0.25)

totalDeathsPerAge = ageAndSuicideRate %>%
  select(age, TotalSuicideRate) %>%
  group_by(age) %>%  
  summarize(TotalDeaths = sum(TotalSuicideRate)) %>%
  mutate(Percentage = paste(as.character(round(TotalDeaths/sum(TotalDeaths)*100)) ,"%")) %>% 
  mutate(Affected = TotalDeaths/sum(TotalDeaths)*100) %>%
  mutate(Unaffected = 100 - Affected) %>%
  select(Affected, Unaffected)

chisq.test(totalDeathsPerAge)
```
Through observation, one can notice that people aged 75 years or older have the highest suicide rate and the rate decreases as we go down the age groups. For the chi-square test, we tested whether age and suicide rates are independent. Assuming alpha = 0.05, with a p-value = we cannot reject the null and conclude that there is a correlation between the age and suicide rate.

2. Does sex affect the suicide rate?
```{r}
sexAndSuicideRate = data %>%
  select(sex, `suicides/100k pop`, year) %>%
  group_by(sex, year) %>%
  summarize(Mean = mean(`suicides/100k pop`)) %>%
  pivot_wider(names_from = "sex", values_from = "Mean") %>%
  mutate(difference = male - female)

ggplot(data = sexAndSuicideRate) + 
    geom_point(mapping = aes(x = factor(year), y = difference), stat = "identity") +
    xlab("Year") + 
    ylab("Difference between male and female rates") + 
    ggtitle("Suicide Rate vs Sex") + theme(axis.text.x = element_text(angle = 90, hjust = 1))

sexAndSuicideRate = sexAndSuicideRate %>%
  select(male, female)

chisq.test(sexAndSuicideRate)
```
It appears that the suicide rate difference amongst men and females is positive. We find that this difference is positive in all cases. With a p-value of 1, we reject the null and conclude that there is no correlation between Sex and Suicide Rate.

3. Correlation between GDP and population suicide rates? A follow-up question to that is, does GDP strongly relate to a certain age-group committing suicides?
```{r GDP to population suicide rate}
gdpToSuicideRate = data %>%
  select(`suicides/100k pop`, `gdp_per_capita ($)`, age)

ggplot(data = gdpToSuicideRate, aes(x = `gdp_per_capita ($)`, y = `suicides/100k pop`)) + geom_point() + geom_smooth(method = "lm") + ylab("Suicides per 100 thousand people") + xlab("GDB per capita") + ggtitle("Suicide counts vs GDP per capita")

ggplot(data = gdpToSuicideRate, aes(x = `gdp_per_capita ($)`, y = `suicides/100k pop`)) + geom_point() + facet_wrap(~age) + geom_smooth(method = "lm") + ylab("Suicides per 100 thousand people") + xlab("GDB per capita") + ggtitle("Suicide counts vs GDP per capita separated by age")

gdpToSuicideRate = gdpToSuicideRate %>%
  select(`suicides/100k pop`)

chisq.test(gdpToSuicideRate)
```
While it appears that there are more cases of suicide when the gdp per capita is low, there is actually no effective correlation between the 2 variables. In terms of age, it seems that the suicide rate increases with age. For the chi-squared test, assuming alpha = 0.05, with a p-value < 2.2 * 10^-16 < alpha, we cannot reject the null and conclude that there is a correlation between gdp and suicide rate.

4. What is the role of generation in the rates we are examining?
```{r}
generationAndSuicideRate = data %>% 
  select (country, year, generation, `suicides/100k pop`) %>%
  group_by(generation, year) %>%
  summarize(TotalSuicideRate=sum(`suicides/100k pop`))

ggplot(data = generationAndSuicideRate, aes(x = `year`, y = TotalSuicideRate, color=generation)) + geom_point() + facet_wrap(~generation) + geom_smooth(method = "lm", color='black') + ylab("Suicides per 100 thousand people") + xlab("Through the years") + ggtitle("Suicide Rate vs Years, for different generations")

totalDeathsPerGeneration = generationAndSuicideRate %>%
  select(generation, TotalSuicideRate) %>%
  group_by(generation) %>%  
  summarize(TotalDeaths=sum(TotalSuicideRate)) %>%
  mutate(Percentage=paste(as.character(round(TotalDeaths/sum(TotalDeaths)*100)),"%"))

ggplot(totalDeathsPerGeneration, aes(x=generation, y=Percentage)) +
  geom_bar(stat="identity", width=1, color="white", fill = "light PINK") +
  ggtitle("Proportion of deaths/generation since 1987 to 2016")  + geom_text(aes(label=Percentage), position=position_dodge(width=0.9), vjust=-0.25)

totalDeathsPerGeneration = ageAndSuicideRate %>%
  select(age, TotalSuicideRate) %>%
  group_by(age) %>%  
  summarize(TotalDeaths=sum(TotalSuicideRate)) %>%
  mutate(Percentage=paste(as.character(round(TotalDeaths/sum(TotalDeaths)*100)) ,"%")) %>% 
  mutate(Affected=TotalDeaths/sum(TotalDeaths)*100)

totalDeathsPerGeneration = totalDeathsPerGeneration %>%
  mutate(Unaffected = 100 - Affected) %>%
  select(Affected, Unaffected)

chisq.test(totalDeathsPerGeneration)
```
As one can notice, the "Silent" generation was the one that saw most number of suicides across the globe. With a chi-square test, we have a p-value of 5.719 * 10^-07. Assuming alpha = 0.05, we cannot reject the null, and we conclude that there is a correlation between the Suicde rate and generation.

5. Which country has the highest suicide rate, per age group, per generation, and through the years? Can it be related to any factor in specific. Answers may be present in the data or may require additional background research.
```{r}
## suicide rate for countries per age group
countryAndAge = data %>%
  select(country, `suicides/100k pop`, age) %>%
  group_by(country, `suicides/100k pop`)


ggplot(countryAndAge, aes(fill = age, y = `suicides/100k pop`, x = country)) + 
    geom_bar(position = "stack", stat = "identity") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1))

## suicide rate for countries per generation
countryAndGeneration = data %>%
  select(country, `suicides/100k pop`, generation) %>%
  group_by(country, `suicides/100k pop`)

ggplot(countryAndGeneration, aes(fill = generation, y = `suicides/100k pop`, x = country)) + 
    geom_bar(position = "stack", stat = "identity") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1))

## suicide rate for countries year-wise
countryAndYear = data %>%
  select(country, `suicides/100k pop`, year) %>%
  group_by(country, `suicides/100k pop`)


ggplot(countryAndYear, aes(fill = year, y = `suicides/100k pop`, x = country)) + 
    geom_bar(position = "stack", stat = "identity") +
    theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

6. What percentage of the population is affected by it?
Was the rate extremely high or low during a period of time? Examine. 
Does confounding possibly appear? Explain.

```{r Percentage of the population affected}
populationsByYear = data %>%
  select(year, suicides_no, population) %>%
  group_by(year) %>%
  summarize(affected = sum(suicides_no),
            pop = sum(population)) %>%
  mutate(percent = 100 * affected / pop) %>%
  select(year, percent)

ggplot(data = populationsByYear, aes(x = factor(year), y = percent)) + geom_point() + ylab("Percentage of world population affected") + xlab("Year") + ggtitle("Percentage vs. Year")  + theme(axis.text.x = element_text(angle = 90, hjust = 1))

populationsByYear = populationsByYear %>%
  select(percent)

chisq.test(populationsByYear)
```
Examining the world population and suicide rate, it seems that in 2006, the suicide percentage peaked. We have consistently decreased our rate since then. In our chi-squared test, assuming alpha = 0.05, we have a p-value of 1 > alpha, so we cannot reject the null and thus conclude that there is no correlation.
